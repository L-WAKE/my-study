<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
</head>

<body>
    <!-- solomon复杂表头配置 -->
    <script>
        let region = [
            {
                firstCol: 0,
                lastCol: 2,
                firstRow: 0,
                lastRow: 0,
            },
            {
                firstCol: 0,
                lastCol: 1,
                firstRow: 1,
                lastRow: 1,
            },
            {
                firstCol: 2,
                lastCol: 2,
                firstRow: 1,
                lastRow: 2,
            },
            {
                firstCol: 3,
                lastCol: 3,
                firstRow: 0,
                lastRow: 2,
            },
        ];
        let cells = [
            [
                {
                    v: "用户",
                    expression: "",
                    properties: {},
                },
                {
                    v: "用户",
                    expression: "",
                    properties: {},
                },
                {
                    v: "用户",
                    expression: "",
                    properties: {},
                },
                {
                    v: "城区名称",
                    expression: "",
                    properties: {},
                },
            ],
            [
                {
                    v: "1",
                    expression: "",
                    properties: {},
                },
                {
                    v: "1",
                    expression: "",
                    properties: {},
                },
                {
                    v: "4",
                    expression: "",
                    properties: {},
                },
                {
                    v: "城区名称",
                    expression: "",
                    properties: {},
                },
            ],
            [
                {
                    v: "2",
                    expression: "",
                    properties: {},
                },
                {
                    v: "3",
                    expression: "",
                    properties: {},
                },
                {
                    v: "4",
                    expression: "",
                    properties: {},
                },
                {
                    v: "城区名称",
                    expression: "",
                    properties: {},
                },
            ],
        ];
        const theadData2 = [
            {
                align: "left",
                label: "用户",
                width: "",
                type: "dim",
                orderType: "",
                clumType: "dimension",
                index: 0,
                children: [
                    {
                        label: "1",
                        isHide: false,
                        id: 1678521451157,
                        index: 1678521451157,
                        children: [],
                        align: "left",
                        prop: "1111",
                        warnEnable: false,
                        conceal: false,
                        warnThresholdOperator: "==",
                    },
                    {
                        label: "2",
                        id: 1678521468353,
                        index: 1678521468353,
                        isHide: false,
                        children: [
                            {
                                label: "7",
                                isHide: false,
                                id: 1678522567299,
                                index: 1678522567299,
                                children: [
                                    {
                                        label: "8",
                                        isHide: false,
                                        id: 1678522571576,
                                        index: 1678522571576,
                                        children: [],
                                        align: "left",
                                        prop: "8888",
                                        warnEnable: false,
                                        conceal: false,
                                        warnThresholdOperator: "==",
                                    },
                                ],
                                align: "left",
                                warnEnable: false,
                                conceal: false,
                                warnThresholdOperator: "==",
                            },
                        ],
                        align: "left",
                        warnEnable: false,
                        conceal: false,
                        warnThresholdOperator: "==",
                    },
                    {
                        label: "3",
                        id: 1678521453653,
                        index: 1678521453653,
                        isHide: false,
                        children: [
                            {
                                label: "4",
                                isHide: false,
                                id: 1678521456117,
                                index: 1678521456117,
                                children: [],
                                prop: "4444",
                                align: "left",
                                warnEnable: false,
                                conceal: false,
                                warnThresholdOperator: "==",
                            },
                        ],
                        align: "left",
                        warnEnable: false,
                        conceal: false,
                        warnThresholdOperator: "==",
                    },
                ],
                isHide: false,
                conceal: false,
                id: 1678521444663,
                warnEnable: false,
                warnThresholdOperator: "==",
            },
            {
                align: "left",
                label: "城区名称",
                width: "",
                type: "dim",
                orderType: "",
                clumType: "dimension",
                index: 1,
                children: [
                    {
                        label: "9",
                        isHide: false,
                        id: 1678522576689,
                        index: 1678522576689,
                        children: [
                            {
                                label: "5",
                                isHide: false,
                                id: 1678521458992,
                                index: 1678521458992,
                                children: [],
                                align: "left",
                                prop: "5555",
                                warnEnable: false,
                                conceal: false,
                                warnThresholdOperator: "==",
                            },
                        ],
                        align: "left",
                        warnEnable: false,
                        conceal: false,
                        warnThresholdOperator: "==",
                    },
                    {
                        label: "6",
                        id: 1678521461896,
                        index: 1678521461896,
                        isHide: false,
                        children: [
                            {
                                label: "10",
                                isHide: false,
                                id: 1678522581923,
                                index: 1678522581923,
                                children: [
                                    {
                                        label: "11",
                                        isHide: false,
                                        id: 1678522579083,
                                        index: 1678522579083,
                                        children: [],
                                        align: "left",
                                        prop: "12222",
                                        warnEnable: false,
                                        conceal: false,
                                        warnThresholdOperator: "==",
                                    },
                                ],
                                align: "left",
                                warnEnable: false,
                                conceal: false,
                                warnThresholdOperator: "==",
                            },
                        ],
                        align: "left",
                        warnEnable: false,
                        conceal: false,
                        warnThresholdOperator: "==",
                    },
                ],
                isHide: false,
                conceal: false,
                id: 1678521444664,
                warnEnable: false,
                warnThresholdOperator: "==",
            },
        ];

        const theadData1 = [
            {
                conceal: false,
                orderType: "",
                index: 0,
                label: "Date",
                align: "center",
                type: "dim",
                drill: "none",
                isHide: false,
                children: [],
                warnThresholdOperator: "==",
                warnEnable: false,
                prop: "342_3",
                width: "",
                id: 1678435304952,
                clumType: "dimension",
            },
            {
                conceal: false,
                orderType: "",
                index: 1,
                label: "DIM_OFFERING_NAME",
                align: "center",
                type: "dim",
                drill: "none",
                isHide: false,
                children: [],
                warnThresholdOperator: "==",
                warnEnable: false,
                prop: "343_1",
                width: "",
                id: 1678435304953,
                clumType: "dimension",
            },
            {
                conceal: false,
                children: [
                    {
                        conceal: false,
                        children: [
                            {
                                conceal: false,
                                orderType: "",
                                index: 2,
                                label: "mo_on_times",
                                align: "center",
                                type: "ind",
                                isHide: false,
                                children: [],
                                warnThresholdOperator: "==",
                                warnEnable: false,
                                prop: "indicator_55",
                                width: "",
                                indLine: false,
                                id: 1678435304954,
                                clumType: "indicator",
                            },
                            {
                                conceal: false,
                                orderType: "",
                                index: 3,
                                label: "mo_on_amount",
                                align: "left",
                                type: "ind",
                                isHide: false,
                                children: [],
                                warnThresholdOperator: "==",
                                warnEnable: false,
                                prop: "indicator_56",
                                width: "",
                                indLine: false,
                                id: 1678435304955,
                                clumType: "indicator",
                            },
                        ],
                        warnThresholdOperator: "==",
                        warnEnable: false,
                        index: 1678435313917,
                        label: "On net",
                        id: 1678435313917,
                        align: "center",
                    },
                    {
                        conceal: false,
                        children: [
                            {
                                conceal: false,
                                orderType: "",
                                index: 4,
                                label: "mo_off_times",
                                align: "left",
                                type: "ind",
                                isHide: false,
                                children: [],
                                warnThresholdOperator: "==",
                                warnEnable: false,
                                prop: "indicator_57",
                                width: "",
                                indLine: false,
                                id: 1678435304956,
                                clumType: "indicator",
                            },
                            {
                                conceal: false,
                                orderType: "",
                                index: 5,
                                label: "mo_off_amount",
                                align: "left",
                                type: "ind",
                                isHide: false,
                                children: [],
                                warnThresholdOperator: "==",
                                warnEnable: false,
                                prop: "indicator_58",
                                width: "",
                                indLine: false,
                                id: 1678435304957,
                                clumType: "indicator",
                            },
                        ],
                        warnThresholdOperator: "==",
                        warnEnable: false,
                        index: 1678435313919,
                        label: "Off Net",
                        id: 1678435313919,
                        align: "center",
                    },
                    {
                        conceal: false,
                        children: [
                            {
                                conceal: false,
                                orderType: "",
                                index: 6,
                                label: "mo_int_times",
                                align: "left",
                                type: "ind",
                                isHide: false,
                                children: [],
                                warnThresholdOperator: "==",
                                warnEnable: false,
                                prop: "indicator_59",
                                width: "",
                                indLine: false,
                                id: 1678435304958,
                                clumType: "indicator",
                            },
                            {
                                conceal: false,
                                orderType: "",
                                index: 7,
                                label: "mo_int_amount",
                                align: "left",
                                type: "ind",
                                isHide: false,
                                children: [],
                                warnThresholdOperator: "==",
                                warnEnable: false,
                                prop: "indicator_60",
                                width: "",
                                indLine: false,
                                id: 1678435304959,
                                clumType: "indicator",
                            },
                        ],
                        warnThresholdOperator: "==",
                        warnEnable: false,
                        index: 1678435313921,
                        label: "International",
                        id: 1678435313921,
                        align: "center",
                    },
                ],
                warnThresholdOperator: "==",
                warnEnable: false,
                index: 1678435321767,
                label: "SMS(MO)",
                id: 1678435321767,
                align: "center",
            },
            {
                conceal: false,
                children: [
                    {
                        conceal: false,
                        children: [
                            {
                                conceal: false,
                                orderType: "",
                                index: 8,
                                label: "mt_on_times",
                                align: "left",
                                type: "ind",
                                isHide: false,
                                children: [],
                                warnThresholdOperator: "==",
                                warnEnable: false,
                                prop: "indicator_61",
                                width: "",
                                indLine: false,
                                id: 1678435304960,
                                clumType: "indicator",
                            },
                            {
                                conceal: false,
                                orderType: "",
                                index: 9,
                                label: "mt_on_amount",
                                align: "left",
                                type: "ind",
                                isHide: false,
                                children: [],
                                warnThresholdOperator: "==",
                                warnEnable: false,
                                prop: "indicator_62",
                                width: "",
                                indLine: false,
                                id: 1678435304961,
                                clumType: "indicator",
                            },
                        ],
                        warnThresholdOperator: "==",
                        warnEnable: false,
                        index: 1678435313923,
                        label: "On net",
                        id: 1678435313923,
                        align: "center",
                    },
                    {
                        conceal: false,
                        children: [
                            {
                                conceal: false,
                                orderType: "",
                                index: 10,
                                label: "mt_off_times",
                                align: "left",
                                type: "ind",
                                isHide: false,
                                children: [],
                                warnThresholdOperator: "==",
                                warnEnable: false,
                                prop: "indicator_63",
                                width: "",
                                indLine: false,
                                id: 1678435304962,
                                clumType: "indicator",
                            },
                            {
                                conceal: false,
                                orderType: "",
                                index: 11,
                                label: "mt_off_amount",
                                align: "left",
                                type: "ind",
                                isHide: false,
                                children: [],
                                warnThresholdOperator: "==",
                                warnEnable: false,
                                prop: "indicator_64",
                                width: "",
                                indLine: false,
                                id: 1678435304963,
                                clumType: "indicator",
                            },
                        ],
                        warnThresholdOperator: "==",
                        warnEnable: false,
                        index: 1678435313925,
                        label: "Off Net",
                        id: 1678435313925,
                        align: "center",
                    },
                    {
                        conceal: false,
                        children: [
                            {
                                conceal: false,
                                orderType: "",
                                index: 12,
                                label: "mt_int_times",
                                align: "left",
                                type: "ind",
                                isHide: false,
                                children: [],
                                warnThresholdOperator: "==",
                                warnEnable: false,
                                prop: "indicator_65",
                                width: "",
                                indLine: false,
                                id: 1678435304964,
                                clumType: "indicator",
                            },
                            {
                                conceal: false,
                                orderType: "",
                                index: 13,
                                label: "mt_int_amount",
                                align: "left",
                                type: "ind",
                                isHide: false,
                                children: [],
                                warnThresholdOperator: "==",
                                warnEnable: false,
                                prop: "indicator_66",
                                width: "",
                                indLine: false,
                                id: 1678435304965,
                                clumType: "indicator",
                            },
                        ],
                        warnThresholdOperator: "==",
                        warnEnable: false,
                        index: 1678435313927,
                        label: "International",
                        id: 1678435313927,
                        align: "center",
                    },
                ],
                warnThresholdOperator: "==",
                warnEnable: false,
                index: 1678435321773,
                label: "SMS(MT)",
                id: 1678435321773,
                align: "center",
            },
            {
                conceal: false,
                children: [
                    {
                        conceal: false,
                        orderType: "",
                        index: 14,
                        label: "Items",
                        type: "exp",
                        align: "left",
                        isHide: false,
                        children: [],
                        warnThresholdOperator: "==",
                        warnEnable: false,
                        prop: "indicator_-1",
                        width: "",
                        id: 1678435702877,
                        clumType: "expression",
                    },
                    {
                        conceal: false,
                        orderType: "",
                        index: 15,
                        label: "Amout(SBD)",
                        type: "exp",
                        align: "left",
                        isHide: false,
                        children: [],
                        warnThresholdOperator: "==",
                        warnEnable: false,
                        prop: "indicator_-2",
                        width: "",
                        id: 1678435702878,
                        clumType: "expression",
                    },
                ],
                warnThresholdOperator: "==",
                warnEnable: false,
                index: 1678439759275,
                label: "ToTal",
                id: 1678439759275,
                align: "center",
                isHide: false,
            },
        ];

        // data1 cols = 5, rows = 4
        // data2 cols = 16,rows = 3;

        const theadData3 = [
            {
                label: "22",
                isHide: false,
                id: 1678674931245,
                index: 1678674931245,
                children: [
                    {
                        label: "11",
                        isHide: false,
                        id: 1678674905226,
                        index: 1678674905226,
                        children: [
                            {
                                label: "33",
                                isHide: false,
                                id: 1678674878897,
                                index: 1678674878897,
                                children: [
                                    {
                                        label: "44",
                                        isHide: false,
                                        id: 1678674872970,
                                        index: 1678674872970,
                                        children: [
                                            {
                                                align: "left",
                                                label: "用户55",
                                                prop: "279_1",
                                                width: "",
                                                type: "dim",
                                                orderType: "",
                                                clumType: "dimension",
                                                index: 0,
                                                children: [],
                                                isHide: false,
                                                conceal: false,
                                                id: 1678674866788,
                                                warnEnable: false,
                                                warnThresholdOperator: "==",
                                            },
                                        ],
                                        align: "left",
                                        warnEnable: false,
                                        conceal: false,
                                        warnThresholdOperator: "==",
                                    },
                                ],
                                align: "left",
                                warnEnable: false,
                                conceal: false,
                                warnThresholdOperator: "==",
                            },
                            {
                                align: "left",
                                label: "城区名称",
                                prop: "280_1",
                                width: "",
                                type: "dim",
                                orderType: "",
                                clumType: "dimension",
                                index: 1,
                                children: [],
                                isHide: false,
                                conceal: false,
                                id: 1678674866789,
                                warnEnable: false,
                                warnThresholdOperator: "==",
                            },
                        ],
                        align: "left",
                        warnEnable: false,
                        conceal: false,
                        warnThresholdOperator: "==",
                    },
                ],
                align: "left",
                warnEnable: false,
                conceal: false,
                warnThresholdOperator: "==",
            },
        ];

        const theadData = [
            {
                label: "5",
                isHide: false,
                id: 1678676774019,
                index: 1678676774019,
                children: [
                    {
                        label: "4",
                        isHide: false,
                        id: 1678676764741,
                        index: 1678676764741,
                        children: [
                            {
                                label: "3",
                                isHide: false,
                                id: 1678676731625,
                                index: 1678676731625,
                                children: [
                                    {
                                        label: "2",
                                        isHide: false,
                                        id: 1678676714935,
                                        index: 1678676714935,
                                        children: [
                                            {
                                                label: "1",
                                                isHide: false,
                                                id: 1678676711717,
                                                index: 1678676711717,
                                                children: [
                                                    {
                                                        align: "left",
                                                        label: "用户",
                                                        prop: "279_1",
                                                        width: "",
                                                        type: "dim",
                                                        orderType: "",
                                                        clumType: "dimension",
                                                        index: 0,
                                                        children: [],
                                                        isHide: false,
                                                        conceal: false,
                                                        id: 1678676701461,
                                                        warnEnable: false,
                                                        warnThresholdOperator: "==",
                                                    },
                                                ],
                                                align: "left",
                                                warnEnable: false,
                                                conceal: false,
                                                warnThresholdOperator: "==",
                                            },
                                        ],
                                        align: "left",
                                        warnEnable: false,
                                        conceal: false,
                                        warnThresholdOperator: "==",
                                    },
                                ],
                                align: "left",
                                warnEnable: false,
                                conceal: false,
                                warnThresholdOperator: "==",
                            },
                        ],
                        align: "left",
                        warnEnable: false,
                        conceal: false,
                        warnThresholdOperator: "==",
                    },
                ],
                align: "left",
                warnEnable: false,
                conceal: false,
                warnThresholdOperator: "==",
            },
            {
                label: "6",
                isHide: false,
                id: 1678676727641,
                index: 1678676727641,
                children: [
                    {
                        label: "7",
                        isHide: false,
                        id: 1678676719015,
                        index: 1678676719015,
                        children: [
                            {
                                align: "left",
                                label: "城区名称",
                                prop: "280_1",
                                width: "",
                                type: "dim",
                                orderType: "",
                                clumType: "dimension",
                                index: 1,
                                children: [],
                                isHide: false,
                                conceal: false,
                                id: 1678676701462,
                                warnEnable: false,
                                warnThresholdOperator: "==",
                            },
                        ],
                        align: "left",
                        warnEnable: false,
                        conceal: false,
                        warnThresholdOperator: "==",
                    },
                ],
                align: "left",
                warnEnable: false,
                conceal: false,
                warnThresholdOperator: "==",
            },
            {
                align: "left",
                label: "消费类型",
                prop: "281_1",
                width: "",
                type: "dim",
                orderType: "",
                clumType: "dimension",
                index: 2,
                children: [],
                isHide: false,
                conceal: false,
                id: 1678676701463,
                warnEnable: false,
                warnThresholdOperator: "==",
            },
            {
                label: "8",
                isHide: false,
                id: 1678676756053,
                index: 1678676756053,
                children: [
                    {
                        label: "9",
                        isHide: false,
                        id: 1678676752860,
                        index: 1678676752860,
                        children: [
                            {
                                label: "10",
                                isHide: false,
                                id: 1678676750619,
                                index: 1678676750619,
                                children: [
                                    {
                                        align: "left",
                                        label: "省",
                                        prop: "283_1",
                                        width: "",
                                        type: "dim",
                                        orderType: "",
                                        clumType: "dimension",
                                        index: 3,
                                        children: [],
                                        isHide: false,
                                        conceal: false,
                                        id: 1678676701464,
                                        warnEnable: false,
                                        warnThresholdOperator: "==",
                                    },
                                ],
                                align: "left",
                                warnEnable: false,
                                conceal: false,
                                warnThresholdOperator: "==",
                            },
                        ],
                        align: "left",
                        warnEnable: false,
                        conceal: false,
                        warnThresholdOperator: "==",
                    },
                ],
                align: "left",
                warnEnable: false,
                conceal: false,
                warnThresholdOperator: "==",
            },
        ];
        //获取所有的叶子节点
        const findLeaf = (list) => {
            let allLeaf = [];
            const findf = (data) => {
                data.forEach((item) => {
                    if (item.children && item.children.length > 0) {
                        findf(item.children);
                    } else allLeaf.push(item);
                });
            };
            findf(list);
            return allLeaf;
        };
        let allDocument = findLeaf(theadData);
        console.log("叶子节点allDocument", allDocument);

        const convertToRows = (originColumns) => {
            let maxLevel = 1;
            const traverse = (column, parent) => {
                if (parent) {
                    column.level = parent.level + 1;
                    if (maxLevel < column.level) {
                        maxLevel = column.level;
                    }
                }
                column.colSpan = column.children.length;
                if (parent && column.children.length > 0)
                    parent.colSpan += column.children.length - 1;
                if (column.children && column.children.length > 0) {
                    column.children.forEach((subColumn) => {
                        traverse(subColumn, column);
                    });
                }
            };

            originColumns.forEach((column) => {
                column.level = 1;
                traverse(column);
            });

            const rows = [];
            for (let i = 0; i < maxLevel; i++) {
                rows.push([]);
            }

            const allColumns = getAllColumns(originColumns);
            console.log("allColumns", allColumns);
            allColumns.forEach((column) => {
                if (!!column.prop) {
                    column.rowSpan = maxLevel - column.level + 1;
                } else {
                    column.rowSpan = 1;
                }
                rows[column.level - 1].push(column);
            });

            return [rows, maxLevel];
        };

        const getAllColumns = (columns) => {
            const result = [];
            columns.forEach((column) => {
                if (column.children) {
                    result.push(column);
                    result.push.apply(result, getAllColumns(column.children));
                } else {
                    result.push(column);
                }
            });
            return result;
        };

        let cols = allDocument.length;
        let handleArr = [];
        let maxRow = convertToRows(theadData)[1];
        for (let i = 0; i < maxRow; i++) {
            if (!handleArr[i]) {
                handleArr[i] = [];
            }
            for (let n = 0; n < cols; n++) {
                handleArr[i][n] = "";
            }
        }

        let tmp = convertToRows(theadData)[0];
        console.log(tmp);
        let maxCols = 0;
        tmp.forEach((item, index) => {
            item.forEach((subItem, subIndex) => {
                let tmpIndex = subIndex;
                for (let i = tmpIndex; i < cols; i++) {
                    if (handleArr[index][i] == "") {
                        handleArr[index][i] = subItem.label;
                        tmpIndex = i;
                        break;
                    }
                }
                // handleArr[index][subIndex]=subItem.label;
                if (subItem.rowSpan > 1) {
                    for (
                        let i = subItem.level;
                        i < subItem.level + subItem.rowSpan - 1;
                        i++
                    ) {
                        handleArr[i][tmpIndex] = subItem.label;
                    }
                }
                if (subItem.colSpan > 1) {
                    for (let i = 1; i < subItem.colSpan; i++) {
                        tmpIndex++;
                        handleArr[index][tmpIndex] = subItem.label;
                    }
                }
            });
        });

        let cellsAll = [];
        handleArr.forEach((item) => {
            let tmpArr = [];
            item.forEach((v) => {
                tmpArr.push({
                    v: v,
                    expression: "",
                    properties: {},
                });
            });
            cellsAll.push(tmpArr);
        });
        console.log("handleArr", handleArr);
        console.log("cellsAll", cellsAll);

      // let level = 1
      // const setLevel = (list) => {
      //     let len = list.length
      //     list.forEach((item, index) => {
      //         item.level = level
      //         if (item.children && item.children.length > 0) {
      //             level = level + 1
      //             setLevel(item.children)
      //         }
      //     })
      // }
      // setLevel(theadData)
    </script>
</body>

</html>